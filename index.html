<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Longcat Stable Verified</title>

<style>
body{
margin:0;
background:#f7f1e3;
font-family:"Microsoft JhengHei";
display:flex;
flex-direction:column;
align-items:center;
}
canvas{
background:#fff;
margin-top:20px;
border-radius:14px;
box-shadow:0 10px 25px rgba(0,0,0,.15);
}
.panel{
background:#fff;
padding:12px 20px;
margin-top:15px;
border-radius:12px;
box-shadow:0 5px 10px rgba(0,0,0,.1);
}
</style>
</head>

<body>

<div class="panel">
é—œå¡ <span id="lvl">1</span> ï½œ Z å¾©åŸ
</div>

<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let TILE=70;
let grid=[],catPath=[];
let history=[];
let level=1;

//////////////////////////////////////////////////
// å·²é©—è­‰é—œå¡
//////////////////////////////////////////////////

const LEVELS=[
{m:[[2,0],[1,0]]},
{m:[[2,0,0],[0,1,0],[0,0,0]]},
{m:[[0,0,2],[1,1,0],[0,0,0]]}
];

//////////////////////////////////////////////////
// åˆå§‹åŒ–
//////////////////////////////////////////////////

function init(){

grid=LEVELS[level-1].m.map(r=>[...r]);
catPath=[];
history=[];

for(let y=0;y<grid.length;y++){
for(let x=0;x<grid[0].length;x++){
if(grid[y][x]==2){
catPath.push({x,y});
grid[y][x]=3;
}
}
}

canvas.width=grid[0].length*TILE;
canvas.height=grid.length*TILE;

document.getElementById("lvl").innerText=level;
draw();
}

//////////////////////////////////////////////////
// Undo
//////////////////////////////////////////////////

function saveState(){
history.push({
grid:grid.map(r=>[...r]),
path:catPath.map(p=>({...p}))
});
}

function undo(){
if(!history.length) return;
let s=history.pop();
grid=s.grid;
catPath=s.path;
draw();
}

//////////////////////////////////////////////////
// â­ æ­£ç¢ºé˜²æ­»å±€ï¼šé¿å…å­¤ç«‹å–®æ ¼
//////////////////////////////////////////////////

function createsIsolatedCell(){

for(let y=0;y<grid.length;y++){
for(let x=0;x<grid[0].length;x++){

if(grid[y][x]!==0) continue;

let walls=0;

[[1,0],[-1,0],[0,1],[0,-1]].forEach(d=>{
let nx=x+d[0];
let ny=y+d[1];
if(grid[ny]?.[nx]!==0) walls++;
});

if(walls===4) return true;
}
}

return false;
}

//////////////////////////////////////////////////
// ç§»å‹•
//////////////////////////////////////////////////

function move(dx,dy){

saveState();

let head=catPath.at(-1);
let moved=false;

while(true){

let nx=head.x+dx;
let ny=head.y+dy;

if(grid[ny]?.[nx]!==0) break;

grid[ny][nx]=3;
catPath.push({x:nx,y:ny});
head={x:nx,y:ny};
moved=true;

if(createsIsolatedCell()){
undo();
return;
}
}

if(moved){
draw();
checkWin();
}
}

//////////////////////////////////////////////////
// å‹åˆ©
//////////////////////////////////////////////////

function checkWin(){
if(grid.some(r=>r.includes(0))) return;

setTimeout(()=>{
level++;
if(level>LEVELS.length){
alert("ğŸ± å…¨éƒ¨å®Œæˆï¼");
level=1;
}
init();
},250);
}

//////////////////////////////////////////////////
// ç¹ªè£½
//////////////////////////////////////////////////

function draw(){

ctx.clearRect(0,0,canvas.width,canvas.height);

grid.forEach((row,y)=>{
row.forEach((cell,x)=>{
ctx.strokeStyle="#eee";
ctx.strokeRect(x*TILE,y*TILE,TILE,TILE);

if(cell==1){
ctx.font="40px Arial";
ctx.fillText("ğŸ“¦",x*TILE+15,y*TILE+50);
}
});
});

catPath.forEach((p,i)=>{
if(i<catPath.length-1){
ctx.font="24px Arial";
ctx.fillText("ğŸ¾",p.x*TILE+20,p.y*TILE+50);
}
});

let h=catPath.at(-1);
ctx.font="48px Arial";
ctx.fillText("ğŸ±",h.x*TILE+10,h.y*TILE+55);
}

//////////////////////////////////////////////////
// æ§åˆ¶
//////////////////////////////////////////////////

window.addEventListener("keydown",e=>{
if(e.key==="z"||e.key==="Z") undo();
if(e.key==="ArrowUp") move(0,-1);
if(e.key==="ArrowDown") move(0,1);
if(e.key==="ArrowLeft") move(-1,0);
if(e.key==="ArrowRight") move(1,0);
});

init();
</script>
</body>
</html>
