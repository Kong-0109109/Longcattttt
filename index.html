<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Longcat: ç²¾é¸ 20 é—œæŒ‘æˆ°</title>
    <style>
        body {
            display: flex; flex-direction: column; align-items: center;
            background-color: #f7f1e3; font-family: 'Microsoft JhengHei', sans-serif;
            margin: 0; padding: 20px; min-height: 100vh; transition: 0.5s;
        }
        .ui-panel {
            background: white; padding: 15px 30px; border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px;
        }
        canvas {
            background-color: #fff; border: 8px solid #fff;
            border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .stats { font-size: 18px; font-weight: bold; color: #333; }
        .login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; justify-content: center;
            align-items: center; z-index: 100;
        }
        button {
            padding: 10px 25px; border: none; border-radius: 12px;
            background: #ff7675; color: white; cursor: pointer; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="login-modal" class="login-overlay">
    <div class="ui-panel">
        <h2>ğŸ± Longcat ç²¾é¸æŒ‘æˆ° ğŸ±</h2>
        <input type="text" id="username-input" placeholder="è¼¸å…¥ç©å®¶åç¨±" style="padding: 10px; margin-bottom: 10px;">
        <br>
        <button onclick="userLogin()">é€²å…¥éŠæˆ²</button>
    </div>
</div>

<div class="ui-panel">
    <h1><span id="display-name">Player</span></h1>
    <div class="stats">é—œå¡: <span id="lvl-num">1</span> / 20</div>
</div>

<canvas id="gameCanvas"></canvas>

<div style="margin-top:15px; display:flex; gap:10px;">
    <button onclick="resetLevel()">é‡ç©æœ¬é—œ</button>
    <button onclick="logout()" style="background:#aaa;">æ›´æ›å¸³è™Ÿ</button>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let currentUser = "";
    let currentLvl = 1;
    let grid = [];
    let catPath = [];
    let TILE_SIZE = 60;

    // --- æ‰‹å‹•è¨­è¨ˆ 20 é—œåœ°åœ– (0:ç©ºåœ°, 1:ç‰†å£, 2:èµ·é») ---
    const ALL_LEVELS = [
        { m: [[2,0,0],[0,1,0],[0,0,0]], t: {bg:"#f7f1e3", w:"ğŸ“¦", s:"ğŸ±"} }, // 1
        { m: [[1,0,0],[0,2,0],[0,0,1]], t: {bg:"#f7f1e3", w:"ğŸ“¦", s:"ğŸ±"} }, // 2
        { m: [[2,0,1],[0,0,0],[1,0,0]], t: {bg:"#f7f1e3", w:"ğŸ“¦", s:"ğŸ±"} }, // 3
        { m: [[1,0,0,0],[0,2,0,0],[0,0,0,1],[0,0,0,0]], t: {bg:"#f7f1e3", w:"ğŸ“¦", s:"ğŸ±"} }, // 4
        { m: [[2,0,0,1],[0,1,0,0],[0,0,0,0],[1,0,0,0]], t: {bg:"#f7f1e3", w:"ğŸ“¦", s:"ğŸ±"} }, // 5
        { m: [[0,0,1,0],[1,2,0,0],[0,0,1,0],[0,0,0,0]], t: {bg:"#d1ccc0", w:"ğŸ§±", s:"ğŸ±"} }, // 6
        { m: [[0,0,0,0],[0,1,1,0],[0,0,2,0],[0,1,0,0]], t: {bg:"#d1ccc0", w:"ğŸ§±", s:"ğŸ±"} }, // 7
        { m: [[1,0,0,0],[0,0,0,1],[0,1,0,0],[0,0,0,2]], t: {bg:"#d1ccc0", w:"ğŸ§±", s:"ğŸ±"} }, // 8
        { m: [[2,0,0,0,0],[1,1,0,1,0],[0,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0]], t: {bg:"#d1ccc0", w:"ğŸ§±", s:"ğŸ±"} }, // 9
        { m: [[0,0,1,0,0],[0,2,0,0,0],[1,0,1,0,1],[0,0,0,0,0],[0,0,0,0,0]], t: {bg:"#d1ccc0", w:"ğŸ§±", s:"ğŸ±"} }, // 10
        { m: [[2,0,0,0,0,0],[0,1,1,1,1,0],[0,0,0,0,0,0],[0,1,1,1,1,0],[0,0,0,0,0,0]], t: {bg:"#ffb8b8", w:"ğŸŒ¸", s:"ğŸ¦Š"} }, // 11
        { m: [[0,0,0,0,0,1],[0,1,1,1,0,0],[2,0,0,0,0,0],[0,1,1,1,0,0],[0,0,0,0,0,1]], t: {bg:"#ffb8b8", w:"ğŸŒ¸", s:"ğŸ¦Š"} }, // 12
        { m: [[1,0,0,0,0,1],[0,0,1,1,0,0],[0,1,2,0,0,0],[0,0,1,1,0,0],[1,0,0,0,0,1]], t: {bg:"#ffb8b8", w:"ğŸŒ¸", s:"ğŸ¦Š"} }, // 13
        { m: [[0,0,0,0,1,0],[0,2,1,0,0,0],[0,0,0,0,1,0],[1,1,1,0,0,0],[0,0,0,0,0,0]], t: {bg:"#ffb8b8", w:"ğŸŒ¸", s:"ğŸ¦Š"} }, // 14
        { m: [[2,0,0,0,0,0,0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0]], t: {bg:"#ffb8b8", w:"ğŸŒ¸", s:"ğŸ¦Š"} }, // 15
        { m: [[0,0,0,0,0,0,1],[0,1,1,0,1,0,0],[0,1,2,0,1,0,0],[0,1,1,0,1,0,0],[0,0,0,0,0,0,1]], t: {bg:"#706fd3", w:"ğŸ’", s:"ğŸ²"} }, // 16
        { m: [[2,0,0,1,0,0,0],[0,1,0,0,0,1,0],[0,0,0,1,0,0,0],[1,0,1,0,1,0,1],[0,0,0,0,0,0,0]], t: {bg:"#706fd3", w:"ğŸ’", s:"ğŸ²"} }, // 17
        { m: [[0,0,0,0,0,0,0],[0,1,1,0,1,1,0],[0,1,0,0,0,1,0],[0,0,0,2,0,0,0],[0,1,1,0,1,1,0]], t: {bg:"#706fd3", w:"ğŸ’", s:"ğŸ²"} }, // 18
        { m: [[0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,0],[0,0,0,0,0,0,0,2]], t: {bg:"#706fd3", w:"ğŸ’", s:"ğŸ²"} }, // 19
        { m: [[2,0,0,0,0,0,0,0],[0,1,0,1,0,1,0,1],[0,0,0,0,0,0,0,0],[1,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0]], t: {bg:"#706fd3", w:"ğŸ’", s:"ğŸ²"} }  // 20
    ];

    function userLogin() {
        const name = document.getElementById('username-input').value.trim();
        if(!name) return;
        currentUser = name;
        const saved = JSON.parse(localStorage.getItem('lc_20fixed_'+name)) || {lvl:1};
        currentLvl = Math.min(saved.lvl, 20);
        document.getElementById('login-modal').style.display = 'none';
        document.getElementById('display-name').innerText = name;
        initLevel();
    }

    function initLevel() {
        const data = ALL_LEVELS[currentLvl - 1];
        grid = data.m.map(r => [...r]);
        catPath = [];
        document.body.style.backgroundColor = data.t.bg;

        for(let r=0; r<grid.length; r++) {
            for(let c=0; c<grid[0].length; c++) {
                if(grid[r][c] === 2) {
                    catPath.push({x:c, y:r});
                    grid[r][c] = 3;
                }
            }
        }
        TILE_SIZE = Math.min(65, (window.innerHeight*0.5)/grid.length);
        canvas.width = grid[0].length * TILE_SIZE;
        canvas.height = grid.length * TILE_SIZE;
        document.getElementById('lvl-num').innerText = currentLvl;
        draw();
    }

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const data = ALL_LEVELS[currentLvl-1];
        grid.forEach((row, r) => row.forEach((cell, c) => {
            ctx.strokeStyle = "rgba(0,0,0,0.05)";
            ctx.strokeRect(c*TILE_SIZE, r*TILE_SIZE, TILE_SIZE, TILE_SIZE);
            if(cell === 1) {
                ctx.font = (TILE_SIZE*0.7)+"px Arial";
                ctx.fillText(data.t.w, c*TILE_SIZE+TILE_SIZE*0.15, r*TILE_SIZE+TILE_SIZE*0.75);
            }
        }));
        catPath.forEach((p, i) => {
            if(i < catPath.length-1) {
                ctx.font = (TILE_SIZE*0.5)+"px Arial";
                ctx.fillText("ğŸ¾", p.x*TILE_SIZE+TILE_SIZE*0.25, p.y*TILE_SIZE+TILE_SIZE*0.7);
            }
        });
        const head = catPath[catPath.length-1];
        ctx.font = (TILE_SIZE*0.8)+"px Arial";
        ctx.fillText(data.t.s, head.x*TILE_SIZE+TILE_SIZE*0.1, head.y*TILE_SIZE+TILE_SIZE*0.8);
    }

    function move(dx, dy) {
        let head = catPath[catPath.length-1], moved = false;
        while(true) {
            let nx = head.x+dx, ny = head.y+dy;
            if(ny>=0 && ny<grid.length && nx>=0 && nx<grid[0].length && grid[ny][nx]===0) {
                grid[ny][nx]=3; catPath.push({x:nx, y:ny}); head={x:nx, y:ny}; moved=true;
            } else break;
        }
        if(moved) { draw(); checkWin(); }
    }

    function checkWin() {
        const hasEmpty = grid.some(r => r.includes(0));
        if(!hasEmpty) {
            setTimeout(() => {
                if(currentLvl < 20) {
                    currentLvl++;
                    localStorage.setItem('lc_20fixed_'+currentUser, JSON.stringify({lvl:currentLvl}));
                    initLevel();
                } else {
                    alert("è¬æ­²ï¼ä½ é€šé—œäº†æ‰€æœ‰ç²¾é¸ 20 é—œï¼");
                }
            }, 200);
        }
    }

    function resetLevel() { initLevel(); }
    function logout() { location.reload(); }

    window.addEventListener('keydown', e => {
        if(e.key.includes("Arrow")) {
            e.preventDefault();
            if(e.key === "ArrowUp") move(0,-1);
            if(e.key === "ArrowDown") move(0,1);
            if(e.key === "ArrowLeft") move(-1,0);
            if(e.key === "ArrowRight") move(1,0);
        }
    });
</script>
</body>
</html>
